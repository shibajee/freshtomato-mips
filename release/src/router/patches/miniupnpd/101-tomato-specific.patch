--- miniupnpd/genconfig.sh
+++ miniupnpd/genconfig.sh
@@ -96,11 +96,11 @@ if [ -f ./os.astlinux ]; then
 	OS_VERSION=$(cat ./os.astlinux)
 fi
 
-# Tomato USB special case
+# Tomato special case
 if [ -f ../shared/tomato_version ]; then
 	OS_NAME=Tomato
-	TOMATO_VER=`cat ../shared/tomato_version | cut -d' ' -f2,3`
-	OS_VERSION="Tomato $TOMATO_VER"
+	TOMATO_VER=`cat ../shared/tomato_version | cut -d' ' -f1,2`
+	OS_VERSION="FreshTomato $TOMATO_VER"
 fi
 
 ${RM} ${CONFIGFILE}
@@ -352,8 +352,8 @@ case $OS_NAME in
 		FW=iptables
 		;;
 	Tomato)
-		OS_NAME=UPnP
-		OS_URL=http://tomatousb.org/
+		OS_NAME=FreshTomato
+		OS_URL=https://freshtomato.org/
 		echo "" >> ${CONFIGFILE}
 		echo "#ifndef TOMATO" >> ${CONFIGFILE}
 		echo "#define TOMATO" >> ${CONFIGFILE}
--- miniupnpd/netfilter/iptcrdr.c
+++ miniupnpd/netfilter/iptcrdr.c
@@ -14,8 +14,8 @@
 #include <netinet/in.h>
 #include <arpa/inet.h>
 #include <dlfcn.h>
-#include <xtables.h>
+#include <iptables.h>
 #include <linux/netfilter/xt_DSCP.h>
 #include <libiptc/libiptc.h>
 
 #include <linux/version.h>
@@ -31,7 +31,7 @@
 #define ARRAY_SIZE(arr) (sizeof(arr) / sizeof((arr)[0]) + __must_be_array(arr))
 #define LIST_POISON2  ((void *) 0x00200200 )
 
-#if 0
+#if 1
 #include <linux/netfilter/nf_nat.h>
 #else
 #include "tiny_nf_nat.h"
@@ -44,7 +44,7 @@
 #if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,22)
 #include <linux/netfilter_ipv4/ip_nat.h>
 #else
-#if 0
+#if 1
 #include <linux/netfilter/nf_nat.h>
 #else
 #include "tiny_nf_nat.h"
--- miniupnpd/netfilter/iptpinhole.c
+++ miniupnpd/netfilter/iptpinhole.c
@@ -20,7 +20,7 @@
 
 #ifdef ENABLE_UPNPPINHOLE
 
-#include <xtables.h>
+#include <iptables.h>
 #include <libiptc/libip6tc.h>
 #include "tiny_nf_nat.h"
 
